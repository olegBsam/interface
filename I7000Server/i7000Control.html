<html> 
	<head> 
		<meta charset="utf-8"> 
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7/jquery.js"></script> 
		<script src="http://malsup.github.com/jquery.form.js"></script> 
		<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
		
		<script> 
			function checkValidation(form){ 
				if(form == 'formPort'){ 
					var number = $("#portNumber").val(); 
					return (number.length != 0 && number >= 0); 
				} 
				if(form == 'formCommand'){
					return ($("#command").val().length != 0); 
				}
				
				var frequency = $("#frequency").val();
				var amplitude = $("#amplitude").val();
				var samplingFrequency = $("#samplingFrequency").val();
				var lenghter = (frequency.length != 0 && amplitude.length != 0 && samplingFrequency.length != 0);
				var moreThenZero = (frequency > 0 && amplitude > 0 && samplingFrequency > 0);
				
				return (lenghter && moreThenZero && samplingFrequency < document.getElementById('speed').val());
			} 
		</script> 
		
		<script> 
			function AjaxFormRequest(form, button) { 
				if(!checkValidation(form)){ 
					alert('Некорректные данные'); 
					return; 
				} 
				jQuery.ajax({ 
					type: "GET", 
					dataType: "html", 
					data: jQuery("#"+form).serialize(),
					
					success: function(result){
						$('#frame').attr('src', $('#frame').attr('src'));
						if(button.id == 'openPort') {
							button.disabled = true;
							document.getElementById('portNumber').disabled = true;
							document.getElementById('speed').disabled = true;
							document.getElementById('closePort').disabled = false;
							document.getElementById('command').disabled = false;
							document.getElementById('buttonCommand').disabled = false;
							document.getElementById('frequency').disabled = false;
							document.getElementById('amplitude').disabled = false;
							document.getElementById('samplingFrequency').disabled = false;
							document.getElementById('buttonMeandrHanded').disabled = false;
							document.getElementById('buttonMeandrAutomatic').disabled = false;
						}
						else if(button.id == 'closePort') {
							button.disabled = true;
							document.getElementById('portNumber').disabled = false;
							document.getElementById('speed').disabled = false;
							document.getElementById('openPort').disabled = false;
							document.getElementById('command').disabled = true;
							document.getElementById('buttonCommand').disabled = true;
							document.getElementById('frequency').disabled = true;
							document.getElementById('amplitude').disabled = true;
							document.getElementById('samplingFrequency').disabled = true;
							document.getElementById('buttonMeandrHanded').disabled = true;
							document.getElementById('buttonMeandrAutomatic').disabled = true;
						}
                    },
                    statusCode:{ 
						425:function(){ 
							button.disabled = false;
							document.getElementById('portNumber').disabled = false;
							document.getElementById('speed').disabled = false;
							document.getElementById('openPort').disabled = false;
							document.getElementById('closePort').disabled = false;
							document.getElementById('command').disabled = false;
							document.getElementById('buttonCommand').disabled = false;
							document.getElementById('frequency').disabled = false;
							document.getElementById('amplitude').disabled = false;
							document.getElementById('samplingFrequency').disabled = false;
							document.getElementById('buttonMeandrHanded').disabled = false;
							document.getElementById('buttonMeandrAutomatic').disabled = false;
						alert('Не удалось открыть порт'); 
						}, 
						427:function(){ 
						alert('Не удалось записать команду в порт'); 
						} 
					}
				})
				return false;
			} 
		</script> 
		
		<script type="text/javascript">
			google.charts.load('current', {'packages':['corechart']});
			google.charts.setOnLoadCallback(drawChart);
			function drawChart() {
				var data = google.visualization.arrayToDataTable([
				  ['Время', 'Значение'],
				  ['0',  0]
				]);

				var options = {
					title: 'Меандр',
					legend: { position: 'bottom' }
				};

				var chart = new google.visualization.LineChart(document.getElementById('curve_chart'));

				chart.draw(data, options);
			  }
		</script>
	
		<style type="text/css">
			textarea { resize: none; }
			#content {
				position: absolute;
				top: -20px; /* Расстояние от верхнего края */
				left: 460px; /* Расстояние от левого края */ 
			}
			
			#curve_chart {
				position: absolute;
				left: -110px; /* Расстояние от левого края */
				width: 900px; 
				height: 500px;
			}
		</style>
	</head> 
	
	<body> 
		<form method="get" action="" id="formPort"> 
			<input id="portNumber" type="number" name="portNumber" placeholder="Номер порта" maxlength="30" autocomplete="off" />
			<p>Скорость:</p> 
			<p><select name="speed" id = "speed" size="5">
				<option value="19200">19200</option>
				<option selected="selected" value="9600">9600</option>
				<option value="4800">4800</option>
				<option value="2400">2400</option>
				<option value="1200">1200</option>
			</select></p> 
			<input id="openPort" type="button" value="Открыть порт" onclick="AjaxFormRequest('formPort', this)"/>
			<input id="closePort" type="button" value="Закрыть порт" disabled="true" onclick="AjaxFormRequest('formPort', this)"/> 
		</form> 
		
		<form method="get" action="" id="formCommand"> 
			<input id="command" type="text" name="command" placeholder="Команда" disabled="true" maxlength="50" autocomplete="off" /> 
			<input id="buttonCommand" type="button" value="Отправить команду" disabled="true" onclick="AjaxFormRequest('formCommand', this)"/> 
		</form> 

		<p>История команд:</p> 
		<iframe src="http://127.0.0.1:8080/history.html" id="frame"> </iframe>
		
		<div id="content">
			<h2>Меандр</h2>
			
			<form method="get" action="" id="formMeandr"> 
				<input id="frequency" type="number" name="frequency" placeholder="Частота" maxlength="5" autocomplete="off" disabled="true"/> 
				<input id="amplitude" type="number" name="amplitude" placeholder="Амплитуда" maxlength="5" autocomplete="off" disabled="true"/> 
				<input id="samplingFrequency" type="number" name="samplingFrequency" placeholder="Частота дискретизации" maxlength="5" autocomplete="off" disabled="true"/> 
				
				<input id="buttonMeandrHanded" type="button" value="Построить меандр" onclick="AjaxFormRequest('formMeandr', this)" disabled="true"/> 
				<input id="buttonMeandrAutomatic" type="button" value="Получить меандр" onclick="AjaxFormRequest('formMeandr', this)" disabled="true"/> 
			</form> 
			
			<div id="curve_chart"></div>
		</div>
		
	</body> 
	</html>